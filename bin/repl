#!/usr/bin/env node
'use strict'

process.title = 'equation'
var readline = require('node-color-readline')
var chalk = require('chalk')
var Context = require('../')
var colorize = require('./colorize')
var context = new Context()
chalk.enabled = true

if (require.main === module) { main() }

function main () {
  var input = process.stdin
  var output = process.stderr

  if (process.argv[2] === '-e') {
    var expr = context.eval(process.argv.slice(3).join(' '))
    output.write(expr.dump())
    output.write('\n')
    return
  }
  var i = 1

  function exec (cmd) {
    var expr = context.eval(cmd)
    if (!expr) return
    output.write(expr.dump())
    output.write('\n')
    i++
  }

  var rl = readline.createInterface({
    input: input,
    output: output,
    colorize: function (str) {
      return colorize(str, context)
    }
  })

  rl.on('line', function (cmd) {
    exec(cmd)
    rl.prompt()
  })

  rl.prompt()
}
